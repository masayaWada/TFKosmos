# ScanPage E2Eテスト実行手順

このファイルは、スキャン設定画面（ScanPage）のE2Eテストを実行するためのガイドです。

## 前提条件

- [ ] バックエンドが起動している（http://localhost:8000）
- [ ] フロントエンドが起動している（http://localhost:5173）

## テスト実行方法

Claudeに以下のように指示してください：

```
このファイルのテストケースを順番に実行してください。
各テストケースの実行結果をチェックボックスで記録してください。
```

---

## 3.1 プロバイダー選択テスト

### テストケース 3.1.1: 初期表示時にAWSが選択されている

**目的**: スキャン設定画面にアクセスすると、デフォルトでAWSラジオボタンが選択されていることを確認する

**手順**:
1. http://localhost:5173/scan にアクセス
2. ページスナップショットを取得
3. AWSラジオボタンが選択されていることを確認

**期待結果**:
- AWSラジオボタンが`checked`状態
- AWS IAMスキャン設定フォームが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_navigate({ url: "http://localhost:5173/scan" })
2. mcp__playwright__browser_snapshot({})
3. "AWS" ラジオボタンの checked 属性を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.1.2: Azureラジオボタンをクリックして切り替え

**目的**: Azureラジオボタンをクリックすると、Azureが選択されてフォームが切り替わることを確認する

**手順**:
1. 前のテストの続きから
2. Azureラジオボタンをクリック
3. ページスナップショットを取得
4. Azureフォームが表示されることを確認

**期待結果**:
- Azureラジオボタンが`checked`状態
- Azure IAMスキャン設定フォームが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_click({ element: "Azure radio button", ref: "..." })
2. mcp__playwright__browser_snapshot({})
3. Azure固有のフィールド（スコープタイプ等）が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.1.3: AWSラジオボタンに戻る

**目的**: AWSラジオボタンをクリックすると、再度AWSフォームに切り替わることを確認する

**手順**:
1. 前のテストの続きから
2. AWSラジオボタンをクリック
3. ページスナップショットを取得
4. AWSフォームが表示されることを確認

**期待結果**:
- AWSラジオボタンが`checked`状態
- AWS IAMスキャン設定フォームが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_click({ element: "AWS radio button", ref: "..." })
2. mcp__playwright__browser_snapshot({})
3. AWS固有のフィールド（プロファイル等）が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 3.2 AWSスキャン設定テスト

### テストケース 3.2.1: プロファイル入力フィールドの表示

**目的**: AWSフォームにプロファイル入力欄が表示されることを確認する

**手順**:
1. AWS選択状態で
2. ページスナップショットを取得
3. プロファイル入力フィールドを確認

**期待結果**:
- "プロファイル" ラベルが表示される
- プレースホルダーに "default" が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "プロファイル" フィールドの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.2: Assume Role ARN入力フィールドの表示

**目的**: Assume Role ARN入力欄が表示されることを確認する

**手順**:
1. AWS選択状態で
2. ページスナップショットを取得
3. Assume Role ARN入力フィールドを確認

**期待結果**:
- "Assume Role ARN (オプション)" ラベルが表示される
- 入力欄が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "Assume Role ARN" フィールドの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.3: スキャン対象チェックボックスの表示

**目的**: Users, Groups, Roles, Policies, Attachmentsのチェックボックスが表示されることを確認する

**手順**:
1. AWS選択状態で
2. ページスナップショットを取得
3. すべてのスキャン対象チェックボックスを確認

**期待結果**:
- Users, Groups, Roles, Policies, Attachments のチェックボックスが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. 各チェックボックスの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.4: デフォルトのスキャン対象

**目的**: デフォルトでUsers, Groups, Attachmentsがチェック済みであることを確認する

**手順**:
1. AWS選択状態で
2. ページスナップショットを取得
3. デフォルトチェック状態を確認

**期待結果**:
- Users: checked
- Groups: checked
- Roles: unchecked
- Policies: unchecked
- Attachments: checked

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. 各チェックボックスの checked 属性を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.5: スキャン対象の全選択

**目的**: すべてのチェックボックスを選択できることを確認する

**手順**:
1. AWS選択状態で
2. Roles, Policiesチェックボックスをクリック
3. ページスナップショットを取得
4. すべてがチェックされたことを確認

**期待結果**:
- すべてのスキャン対象がチェック済み

**実行**:
```
# 実装コマンド例
1. Roles チェックボックスをクリック
2. Policies チェックボックスをクリック
3. mcp__playwright__browser_snapshot({})
4. すべてのチェックボックスが checked になっていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.6: スキャン対象の全解除

**目的**: すべてのチェックボックスを解除できることを確認する

**手順**:
1. 前のテストの続きから
2. すべてのチェックボックスをクリックして解除
3. ページスナップショットを取得
4. すべてが未チェックになったことを確認

**期待結果**:
- すべてのスキャン対象が未チェック

**実行**:
```
# 実装コマンド例
1. 各チェックボックスをクリックして解除
2. mcp__playwright__browser_snapshot({})
3. すべてのチェックボックスが unchecked になっていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.2.7: 名前プレフィックスフィルタの入力

**目的**: 名前プレフィックスフィルタに値を入力できることを確認する

**手順**:
1. AWS選択状態で
2. 名前プレフィックスフィールドに "test-" を入力
3. ページスナップショットを取得
4. 入力値が反映されていることを確認

**期待結果**:
- 名前プレフィックスフィールドに "test-" が入力される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_type({ element: "名前プレフィックスフィルタ", ref: "...", text: "test-" })
2. mcp__playwright__browser_snapshot({})
3. フィールドの値が "test-" になっていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 3.3 Azureスキャン設定テスト

### テストケース 3.3.1: スコープタイプドロップダウンの表示

**目的**: スコープタイプドロップダウンが表示され、subscription / resource_groupの選択肢があることを確認する

**手順**:
1. Azureラジオボタンを選択
2. ページスナップショットを取得
3. スコープタイプドロップダウンを確認

**期待結果**:
- スコープタイプドロップダウンが表示される
- subscription / resource_group の選択肢がある

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_click({ element: "Azure radio button", ref: "..." })
2. mcp__playwright__browser_snapshot({})
3. スコープタイプドロップダウンの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.3.2: サブスクリプション一覧の読み込み

**目的**: Azure接続設定に基づいてサブスクリプション一覧が表示されることを確認する

**注意**: このテストは、事前に接続設定ページでAzure接続テストが成功している必要があります。

**手順**:
1. Azure選択状態で
2. ページスナップショットを取得
3. サブスクリプションドロップダウンを確認

**期待結果**:
- サブスクリプションドロップダウンが表示される
- （接続設定がある場合）サブスクリプション一覧が表示される
- （接続設定がない場合）エラーメッセージが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. サブスクリプションドロップダウンの存在を確認
3. エラーメッセージまたはサブスクリプション一覧を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.3.3: サブスクリプションの選択

**注意**: このテストは、サブスクリプション一覧が表示されている場合のみ実行できます。

**目的**: サブスクリプションを選択できることを確認する

**手順**:
1. Azure選択状態で
2. サブスクリプションドロップダウンから1つ選択
3. ページスナップショットを取得
4. 選択されたことを確認

**期待結果**:
- サブスクリプションが選択される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_select_option({ element: "サブスクリプション", ref: "...", values: ["..."] })
2. mcp__playwright__browser_snapshot({})
3. 選択された値を確認
```

**結果**: [ ] 成功 / [ ] 失敗 / [ ] スキップ（サブスクリプションなし）

---

### テストケース 3.3.4: resource_group選択時のリソースグループ一覧

**注意**: このテストは、サブスクリプションが選択されている場合のみ実行できます。

**目的**: スコープタイプでresource_groupを選択すると、リソースグループドロップダウンが表示されることを確認する

**手順**:
1. Azure選択状態で
2. サブスクリプションを選択
3. スコープタイプで "resource_group" を選択
4. ページスナップショットを取得
5. リソースグループドロップダウンが表示されることを確認

**期待結果**:
- リソースグループドロップダウンが表示される

**実行**:
```
# 実装コマンド例
1. スコープタイプで "resource_group" を選択
2. mcp__playwright__browser_wait_for({ text: "リソースグループ" })
3. mcp__playwright__browser_snapshot({})
4. リソースグループドロップダウンの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗 / [ ] スキップ（サブスクリプションなし）

---

### テストケース 3.3.5: スキャン対象チェックボックス

**目的**: Role Definitions, Role Assignmentsのチェックボックスが表示されることを確認する

**手順**:
1. Azure選択状態で
2. ページスナップショットを取得
3. スキャン対象チェックボックスを確認

**期待結果**:
- Role Definitions, Role Assignments のチェックボックスが表示される
- デフォルトで両方チェック済み

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. 各チェックボックスの存在とチェック状態を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 3.4 スキャン実行テスト

**注意**: スキャン実行テストは、実際にAWS/Azure APIを呼び出すため、適切な認証情報が設定されている必要があります。
テスト環境では、モックAPIを使用することを推奨します。

### テストケース 3.4.1: スキャン実行ボタンのクリック

**目的**: スキャン実行ボタンをクリックすると、ローディング状態になることを確認する

**手順**:
1. AWS選択状態で
2. プロファイルを入力（オプション）
3. スキャン対象を選択
4. スキャン実行ボタンをクリック
5. ページスナップショットを取得
6. ローディング状態を確認

**期待結果**:
- ボタンのテキストが "スキャン実行中..." に変わる
- ボタンが無効化される

**実行**:
```
# 実装コマンド例
1. スキャン対象を選択（Users, Groups）
2. mcp__playwright__browser_click({ element: "スキャン実行ボタン", ref: "..." })
3. mcp__playwright__browser_wait_for({ text: "スキャン実行中..." })
4. mcp__playwright__browser_snapshot({})
5. ボタンの状態を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.4.2: プログレスバーの表示

**目的**: スキャン中にプログレスバーが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. プログレスバーが表示されるまで待機
3. ページスナップショットを取得

**期待結果**:
- プログレスバーが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ time: 1 })
2. mcp__playwright__browser_snapshot({})
3. プログレスバーの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.4.3: 進捗メッセージの表示

**目的**: スキャン中に進捗メッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 進捗メッセージを確認

**期待結果**:
- "スキャンを開始しています..." などのメッセージが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. 進捗メッセージの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.4.4: スキャン完了時の自動遷移

**注意**: このテストは、実際のスキャンが完了するまで時間がかかる可能性があります。

**目的**: スキャンが完了すると、リソース一覧画面に自動遷移することを確認する

**手順**:
1. スキャン完了まで待機
2. URLを確認
3. ページスナップショットを取得

**期待結果**:
- URLが `/resources/{scan_id}` に変わる
- リソース一覧画面が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ text: "リソース一覧", time: 30 })
2. URLが /resources/ を含むことを確認
3. mcp__playwright__browser_snapshot({})
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.4.5: スキャン失敗時のエラー表示

**注意**: このテストは、意図的にエラーを発生させる必要があります（例：無効な認証情報）。

**目的**: スキャンが失敗した場合、エラーメッセージが表示されることを確認する

**手順**:
1. AWS選択状態で
2. 無効なプロファイルを入力（例：'invalid-profile'）
3. スキャン実行ボタンをクリック
4. エラーメッセージが表示されるまで待機
5. ページスナップショットを取得

**期待結果**:
- エラーメッセージが表示される
- ボタンが再度有効化される

**実行**:
```
# 実装コマンド例
1. プロファイルに "invalid-profile" を入力
2. スキャン実行ボタンをクリック
3. mcp__playwright__browser_wait_for({ text: "エラー", time: 10 })
4. mcp__playwright__browser_snapshot({})
5. エラーメッセージの存在を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 3.4.6: スキャン中のボタン無効化

**目的**: スキャン実行中はボタンが無効化されることを確認する

**手順**:
1. AWS選択状態で
2. スキャン実行ボタンをクリック
3. ページスナップショットを取得
4. ボタンの disabled 属性を確認

**期待結果**:
- スキャン実行中はボタンが無効化される

**実行**:
```
# 実装コマンド例
1. スキャン実行ボタンをクリック
2. mcp__playwright__browser_wait_for({ time: 0.5 })
3. mcp__playwright__browser_snapshot({})
4. ボタンの disabled 属性を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## テスト結果サマリー

### 3.1 プロバイダー選択テスト
- [ ] 3.1.1 初期表示時にAWSが選択
- [ ] 3.1.2 Azureラジオボタンをクリック
- [ ] 3.1.3 AWSラジオボタンに戻る

### 3.2 AWSスキャン設定テスト
- [ ] 3.2.1 プロファイル入力フィールドの表示
- [ ] 3.2.2 Assume Role ARN入力フィールドの表示
- [ ] 3.2.3 スキャン対象チェックボックスの表示
- [ ] 3.2.4 デフォルトのスキャン対象
- [ ] 3.2.5 スキャン対象の全選択
- [ ] 3.2.6 スキャン対象の全解除
- [ ] 3.2.7 名前プレフィックスフィルタの入力

### 3.3 Azureスキャン設定テスト
- [ ] 3.3.1 スコープタイプドロップダウンの表示
- [ ] 3.3.2 サブスクリプション一覧の読み込み
- [ ] 3.3.3 サブスクリプションの選択
- [ ] 3.3.4 resource_group選択時のリソースグループ一覧
- [ ] 3.3.5 スキャン対象チェックボックス

### 3.4 スキャン実行テスト
- [ ] 3.4.1 スキャン実行ボタンのクリック
- [ ] 3.4.2 プログレスバーの表示
- [ ] 3.4.3 進捗メッセージの表示
- [ ] 3.4.4 スキャン完了時の自動遷移
- [ ] 3.4.5 スキャン失敗時のエラー表示
- [ ] 3.4.6 スキャン中のボタン無効化

---

## 実施記録

- 実施日:
- 実施者:
- 環境:
  - バックエンド: http://localhost:8000
  - フロントエンド: http://localhost:5173
- 全体結果: 成功 / 失敗 / 一部失敗

### 備考

（テスト実施時の気づき、問題点、改善提案などを記載）
