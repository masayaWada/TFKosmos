# E2Eテスト

TFKosmosのE2Eテストは、Playwright MCPを使用して実装されています。

## 前提条件

- バックエンドが起動していること（http://localhost:8000）
- フロントエンドが起動していること（http://localhost:5173）
- Playwright MCPが有効化されていること

## テスト実行方法

### 開発環境の起動

```bash
# ターミナル1: バックエンド起動
cd backend
cargo run

# ターミナル2: フロントエンド起動
cd frontend
npm run dev
```

または、Makefileを使用：

```bash
make dev
```

### Claudeでのテスト実行

Claude Codeで以下のように指示してください：

```
tests/e2e/scan-page.test.md のテストを実行してください
```

## テストファイル一覧

### 画面単位のE2Eテスト

- `scan-page.test.md` - スキャン設定画面のE2Eテスト
  - 3.1 プロバイダー選択テスト
  - 3.2 AWSスキャン設定テスト
  - 3.3 Azureスキャン設定テスト
  - 3.4 スキャン実行テスト

- `resources-page.test.md` - リソース一覧画面のE2Eテスト
  - 4.1 画面表示テスト
  - 4.2 リソースタブ（AWS）テスト
  - 4.3 リソースタブ（Azure）テスト
  - 4.4 リソーステーブルテスト
  - 4.5 フィルタ機能テスト
  - 4.6 ページネーションテスト
  - 4.7 選択サマリーテスト
  - 4.8 依存関係グラフテスト

- `generate-page.test.md` - 生成画面のE2Eテスト
  - 5.1 画面表示テスト
  - 5.2 生成設定フォームテスト
  - 5.3 生成実行テスト
  - 5.4 バリデーションパネルテスト
  - 5.5 ダウンロードテスト
  - 5.6 コードプレビューテスト

- `templates-page.test.md` - テンプレート管理画面のE2Eテスト
  - 6.1 画面表示テスト
  - 6.2 テンプレート選択テスト
  - 6.3 テンプレートエディタテスト
  - 6.4 リアルタイムバリデーションテスト
  - 6.5 プレビューテスト
  - 6.6 保存・復元テスト

### フローテスト（複数画面連携）

- `e2e-flow.test.md` - E2Eフローテスト（エンドツーエンドの業務フロー）
  - 7.1 AWSスキャン〜生成フロー（6ステップ）
    - 接続テスト → スキャン実行 → リソース選択 → 生成画面遷移 → コード生成 → ダウンロード
  - 7.2 Azureスキャン〜生成フロー（6ステップ）
    - 接続テスト → サブスクリプション選択 → スキャン実行 → リソース選択 → 生成画面遷移 → コード生成
  - 7.3 テンプレートカスタマイズフロー（5ステップ）
    - テンプレート選択 → 編集 → プレビュー → 保存 → デフォルトに復元

### エラーハンドリング・エッジケーステスト

- `error-handling.test.md` - エラーハンドリングとエッジケースのテスト
  - 8.1 ネットワークエラーテスト
    - 8.1.1 バックエンド停止時のAPI呼び出し
    - 8.1.2 APIタイムアウト
  - 8.2 バリデーションエラーテスト
    - 8.2.1 不正なクエリ構文
    - 8.2.2 不正なテンプレート構文
  - 8.3 データなしの場合のテスト
    - 8.3.1 スキャン結果が空
    - 8.3.2 依存関係グラフのデータなし

## テスト結果の確認

テスト実行後、以下を確認してください：

- すべてのテストケースが✅（成功）になっていること
- エラーメッセージが表示されていないこと
- スクリーンショットが正しく表示されていること

## トラブルシューティング

### バックエンドに接続できない

- バックエンドが起動しているか確認
- ポート8000が使用可能か確認

### フロントエンドに接続できない

- フロントエンドが起動しているか確認
- ポート5173が使用可能か確認

### 要素が見つからない

- セレクタが正しいか確認
- ページが完全に読み込まれているか確認
- `browser_wait_for` を使用して要素の表示を待つ

## 参照

- [TODO.md](../../TODO.md) - テストケース一覧
- [Playwright MCP Documentation](https://github.com/anthropics/anthropic-quickstarts/tree/main/computer-use-demo/mcp-playwright)
