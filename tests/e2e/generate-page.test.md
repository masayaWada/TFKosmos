# GeneratePage E2Eテスト実行手順

このファイルは、生成画面（GeneratePage）のE2Eテストを実行するためのガイドです。

## 前提条件

- [ ] バックエンドが起動している（http://localhost:8000）
- [ ] フロントエンドが起動している（http://localhost:5173）
- [ ] スキャンが完了し、リソースが選択されている（scanIdが必要）

## テスト実行方法

Claudeに以下のように指示してください：

```
このファイルのテストケースを順番に実行してください。
各テストケースの実行結果をチェックボックスで記録してください。
```

---

## 5.1 画面表示テスト

### テストケース 5.1.1: スキャンID表示

**目的**: 生成画面にアクセスすると、URLパラメータのスキャンIDが表示されることを確認する

**手順**:
1. http://localhost:5173/generate/{scanId} にアクセス（scanIdは事前に取得）
2. ページスナップショットを取得
3. スキャンIDが表示されることを確認

**期待結果**:
- ページ上部に「スキャンID: {scanId}」が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_navigate({ url: "http://localhost:5173/generate/test-scan-id-123" })
2. mcp__playwright__browser_snapshot({})
3. "スキャンID:" テキストが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.1.2: 選択リソースの読み込み

**目的**: リソース一覧画面で選択したリソースが正しく読み込まれることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 選択リソースデータが読み込まれることを確認（コンソールログまたはUI表示）

**期待結果**:
- バックエンドAPI `/resources/{scanId}/select` へのリクエストが成功
- 選択されたリソースデータが保持されている

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. ページが正常に読み込まれることを確認
3. エラーメッセージが表示されていないことを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 5.2 生成設定フォームテスト

### テストケース 5.2.1: 出力パス入力フィールド表示

**目的**: 出力パス入力フィールドにデフォルト値「./terraform-output」が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 出力パス入力フィールドを確認

**期待結果**:
- 出力パス入力フィールドが表示される
- デフォルト値として「./terraform-output」が入力されている

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "出力パス" または "Output Path" ラベルを探す
3. 入力フィールドの value が "./terraform-output" であることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.2.2: ファイル分割ルール選択表示

**目的**: ファイル分割ルール選択フィールドに選択肢が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. ファイル分割ルールドロップダウンを確認

**期待結果**:
- ファイル分割ルールドロップダウンが表示される
- by_resource_type等の選択肢が存在する

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "ファイル分割ルール" または "File Split Rule" ラベルを探す
3. ドロップダウンに選択肢が存在することを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.2.3: 命名規則選択表示

**目的**: 命名規則選択フィールドに選択肢が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 命名規則ドロップダウンを確認

**期待結果**:
- 命名規則ドロップダウンが表示される
- snake_case等の選択肢が存在する

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "命名規則" または "Naming Convention" ラベルを探す
3. ドロップダウンに選択肢が存在することを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.2.4: インポートスクリプト形式選択表示

**目的**: インポートスクリプト形式選択フィールドに選択肢が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. インポートスクリプト形式ドロップダウンを確認

**期待結果**:
- インポートスクリプト形式ドロップダウンが表示される
- sh等の選択肢が存在する

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "インポートスクリプト形式" または "Import Script Format" ラベルを探す
3. ドロップダウンに選択肢が存在することを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.2.5: README生成チェックボックス表示

**目的**: README生成チェックボックスが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. README生成チェックボックスを確認

**期待結果**:
- README生成チェックボックスが表示される
- デフォルトでチェックされている（true）

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "README生成" または "Generate README" チェックボックスを探す
3. チェックボックスがチェック済みであることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 5.3 生成実行テスト

### テストケース 5.3.1: 生成実行ボタンのクリック

**目的**: 生成実行ボタンをクリックすると、ローディング状態になることを確認する

**手順**:
1. 前のテストの続きから
2. "生成実行" ボタンを探す
3. ボタンをクリック
4. ページスナップショットを取得

**期待結果**:
- ボタンのテキストが「生成中...」に変わる
- ボタンが無効化される（disabled状態）
- ローディングスピナーが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. mcp__playwright__browser_click({ element: "生成実行 button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 1 })
4. mcp__playwright__browser_snapshot({})
5. ボタンテキストが "生成中..." になっていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.3.2: 生成成功時の成功メッセージ表示

**目的**: 生成が成功すると、成功メッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. 生成完了まで待機
3. ページスナップショットを取得
4. 成功メッセージを確認

**期待結果**:
- 成功メッセージ「Terraformコードの生成が完了しました」が表示される
- ZIPダウンロードボタンが表示される
- バリデーションパネルが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ time: 5 })
2. mcp__playwright__browser_snapshot({})
3. "Terraformコードの生成が完了しました" テキストが表示されることを確認
4. "ZIPダウンロード" ボタンが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: 生成には時間がかかる場合があります。必要に応じて待機時間を調整してください。

---

### テストケース 5.3.3: 生成失敗時のエラーメッセージ表示

**目的**: 生成が失敗すると、エラーメッセージが表示されることを確認する

**手順**:
1. 不正なscanIdで生成画面にアクセス（例: http://localhost:5173/generate/invalid-scan-id）
2. 生成実行ボタンをクリック
3. ページスナップショットを取得
4. エラーメッセージを確認

**期待結果**:
- エラーメッセージが表示される
- ZIPダウンロードボタンは表示されない

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_navigate({ url: "http://localhost:5173/generate/invalid-scan-id" })
2. mcp__playwright__browser_snapshot({})
3. mcp__playwright__browser_click({ element: "生成実行 button", ref: "..." })
4. mcp__playwright__browser_wait_for({ time: 3 })
5. mcp__playwright__browser_snapshot({})
6. エラーメッセージが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.3.4: 生成中のボタン無効化

**目的**: 生成実行中は、生成実行ボタンが無効化されることを確認する

**手順**:
1. 有効なscanIdで生成画面にアクセス
2. 生成実行ボタンをクリック
3. すぐにページスナップショットを取得
4. ボタンの状態を確認

**期待結果**:
- 生成実行ボタンが無効化される（disabled属性が設定される）
- ボタンのテキストが「生成中...」に変わる

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_navigate({ url: "http://localhost:5173/generate/test-scan-id-123" })
2. mcp__playwright__browser_click({ element: "生成実行 button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 0.5 })
4. mcp__playwright__browser_snapshot({})
5. ボタンが無効化されていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 5.4 バリデーションパネルテスト

### テストケース 5.4.1: Terraform CLIステータス表示

**目的**: 生成完了後、Terraform CLIのステータスとバージョンが表示されることを確認する

**手順**:
1. 有効なscanIdで生成を実行し、完了まで待機
2. ページスナップショットを取得
3. バリデーションパネルを確認

**期待結果**:
- バリデーションパネルに「Terraform検証」セクションが表示される
- Terraform CLIのバージョン情報が表示される（例: "Terraform 1.x.x"）

**実行**:
```
# 実装コマンド例
1. （生成完了後の状態から）
2. mcp__playwright__browser_snapshot({})
3. "Terraform検証" または "Terraform Validation" セクションを探す
4. バージョン情報が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.4.2: Terraform CLI未インストール時の警告表示

**目的**: Terraform CLIが未インストールの場合、警告メッセージが表示されることを確認する

**手順**:
1. （Terraform CLIが未インストールの環境で実行）
2. 生成を完了させる
3. ページスナップショットを取得
4. 警告メッセージを確認

**期待結果**:
- 「Terraform CLIが見つかりません」という警告メッセージが表示される
- 検証ボタンが表示されない、または無効化される

**実行**:
```
# 実装コマンド例
1. （生成完了後の状態から）
2. mcp__playwright__browser_snapshot({})
3. 警告メッセージを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: Terraform CLIがインストール済みの場合、このテストはスキップしてください。

---

### テストケース 5.4.3: 検証実行ボタンのクリック

**目的**: 検証実行ボタンをクリックすると、検証が実行されることを確認する

**手順**:
1. （生成完了後、Terraform CLIがインストール済みの状態から）
2. "検証実行" ボタンをクリック
3. ページスナップショットを取得
4. 検証実行中の状態を確認

**期待結果**:
- ボタンのテキストが「検証中...」に変わる
- ローディング状態が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. mcp__playwright__browser_click({ element: "検証実行 button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 1 })
4. mcp__playwright__browser_snapshot({})
5. "検証中..." テキストが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.4.4: 検証成功時の表示

**目的**: 検証が成功すると、緑色のインジケータと「検証成功」が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. 検証完了まで待機
3. ページスナップショットを取得
4. 検証結果を確認

**期待結果**:
- 緑色のインジケータが表示される
- 「検証成功」または "Validation Successful" テキストが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ time: 3 })
2. mcp__playwright__browser_snapshot({})
3. "検証成功" テキストと緑色のインジケータを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.4.5: 検証エラー時の表示

**目的**: 検証エラーが発生すると、エラー一覧が表示されることを確認する

**手順**:
1. （生成されたTerraformコードに意図的にエラーを含む場合）
2. 検証実行ボタンをクリック
3. 検証完了まで待機
4. ページスナップショットを取得
5. エラー一覧を確認

**期待結果**:
- 赤色のインジケータが表示される
- エラーメッセージ一覧が表示される
- エラー件数が表示される（例: "エラー (3)"）

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エラー一覧セクションを確認
3. エラーメッセージが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: 正常なコードが生成される場合、このテストはスキップしてください。

---

### テストケース 5.4.6: 検証警告時の表示

**目的**: 検証警告が発生すると、警告一覧が表示されることを確認する

**手順**:
1. （生成されたTerraformコードに警告が含まれる場合）
2. 検証実行ボタンをクリック
3. 検証完了まで待機
4. ページスナップショットを取得
5. 警告一覧を確認

**期待結果**:
- 黄色の背景またはアイコンで警告が表示される
- 警告メッセージ一覧が表示される
- 警告件数が表示される（例: "警告 (2)"）

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. 警告一覧セクションを確認
3. 警告メッセージが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: 警告が発生しない場合、このテストはスキップしてください。

---

### テストケース 5.4.7: フォーマットチェック結果の表示

**目的**: フォーマットチェック結果が表示されることを確認する

**手順**:
1. 検証完了後の状態から
2. ページスナップショットを取得
3. フォーマットチェック結果を確認

**期待結果**:
- フォーマット状態が表示される（例: "フォーマット済み" または "フォーマットが必要"）
- フォーマットが必要な場合、変更が必要なファイル名が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. フォーマット状態セクションを確認
3. 状態インジケータが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.4.8: 自動フォーマットボタンのクリック

**目的**: 自動フォーマットボタンをクリックすると、フォーマットが実行されることを確認する

**手順**:
1. （フォーマットが必要な状態から）
2. "自動フォーマット" ボタンをクリック
3. フォーマット完了まで待機
4. ページスナップショットを取得
5. フォーマット結果を確認

**期待結果**:
- ボタンのテキストが「フォーマット中...」に変わる
- フォーマット完了後、「フォーマット済み」状態に変わる
- 検証が自動的に再実行される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. mcp__playwright__browser_click({ element: "自動フォーマット button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 3 })
4. mcp__playwright__browser_snapshot({})
5. "フォーマット済み" 状態を確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: フォーマットが不要な場合、このテストはスキップしてください。

---

## 5.5 ダウンロードテスト

### テストケース 5.5.1: 生成後にZIPダウンロードボタン表示

**目的**: 生成完了後、ZIPダウンロードボタンが表示されることを確認する

**手順**:
1. 有効なscanIdで生成を完了させる
2. ページスナップショットを取得
3. ZIPダウンロードボタンを確認

**期待結果**:
- "ZIPダウンロード" ボタンが表示される
- ボタンがクリック可能な状態である

**実行**:
```
# 実装コマンド例
1. （生成完了後の状態から）
2. mcp__playwright__browser_snapshot({})
3. "ZIPダウンロード" ボタンを探す
4. ボタンが表示されていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.5.2: ZIPダウンロードの実行

**目的**: ZIPダウンロードボタンをクリックすると、terraform-output.zipがダウンロードされることを確認する

**手順**:
1. 前のテストの続きから
2. ZIPダウンロードボタンをクリック
3. ダウンロード完了まで待機
4. ページスナップショットを取得

**期待結果**:
- ファイルのダウンロードが開始される
- ブラウザのダウンロードUIが表示される（環境依存）

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. mcp__playwright__browser_click({ element: "ZIPダウンロード button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 2 })
4. mcp__playwright__browser_snapshot({})
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: Playwright MCPではファイルダウンロードの確認が難しい場合があります。

---

### テストケース 5.5.3: ダウンロード成功メッセージ表示

**目的**: ダウンロード完了後、成功メッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 成功メッセージを確認

**期待結果**:
- 成功メッセージ「ZIPファイルのダウンロードが完了しました」が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ time: 1 })
2. mcp__playwright__browser_snapshot({})
3. "ZIPファイルのダウンロードが完了しました" テキストを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.5.4: ダウンロード失敗時のエラー表示

**目的**: ダウンロードが失敗すると、エラーメッセージが表示されることを確認する

**手順**:
1. （バックエンドが停止している状態で）
2. ZIPダウンロードボタンをクリック
3. ページスナップショットを取得
4. エラーメッセージを確認

**期待結果**:
- エラーメッセージが表示される

**実行**:
```
# 実装コマンド例
1. （バックエンドを停止）
2. mcp__playwright__browser_click({ element: "ZIPダウンロード button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 2 })
4. mcp__playwright__browser_snapshot({})
5. エラーメッセージを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: バックエンドを停止する必要があるため、テスト実行に注意してください。

---

## 5.6 コードプレビューテスト

### テストケース 5.6.1: プレビューセクションの表示

**目的**: 生成完了後、コードプレビューセクションが表示されることを確認する

**手順**:
1. 有効なscanIdで生成を完了させる
2. ページスナップショットを取得
3. プレビューセクションを確認

**期待結果**:
- 「プレビュー」見出しが表示される
- CodePreviewコンポーネントが表示される
- 生成されたコードが表示される

**実行**:
```
# 実装コマンド例
1. （生成完了後の状態から）
2. mcp__playwright__browser_snapshot({})
3. "プレビュー" 見出しを探す
4. コードエディタが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.6.2: ファイルタブの切り替え

**目的**: 複数のファイルタブを切り替えて、それぞれの内容を表示できることを確認する

**手順**:
1. 前のテストの続きから
2. ファイルタブを確認
3. 別のタブをクリック
4. ページスナップショットを取得

**期待結果**:
- 複数のファイルタブが表示される（例: main.tf, variables.tf等）
- タブをクリックすると、対応するファイルの内容が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. ファイルタブを探す
3. 別のタブをクリック
4. mcp__playwright__browser_snapshot({})
5. 表示内容が切り替わることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 5.6.3: コードのシンタックスハイライト

**目的**: HCLコードがシンタックスハイライトされて表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. コードエディタの表示を確認

**期待結果**:
- コードがシンタックスハイライトされている
- キーワード、文字列、コメント等が色分けされている

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. コードエディタ内のハイライトを確認（視覚的に判断）
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: シンタックスハイライトは視覚的な確認が必要です。

---

## テスト完了後のクリーンアップ

すべてのテストケースを実行した後、以下のクリーンアップを実行してください：

1. ブラウザを閉じる
```
mcp__playwright__browser_close()
```

2. 開発環境の停止（必要に応じて）
```bash
# バックエンド/フロントエンドのプロセスを停止
Ctrl+C
```

---

## テスト結果サマリー

### 実行日時
- 実行日:
- 実行者:

### 結果統計
- 総テストケース数: 20
- 成功:
- 失敗:
- スキップ:

### 備考・課題
（テスト実行中に発見した問題や改善点をここに記載）

---

最終更新: 2026-01-03
