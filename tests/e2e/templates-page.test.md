# TemplatesPage E2Eテスト実行手順

このファイルは、テンプレート管理画面（TemplatesPage）のE2Eテストを実行するためのガイドです。

## 前提条件

- [ ] バックエンドが起動している（http://localhost:8000）
- [ ] フロントエンドが起動している（http://localhost:5173）
- [ ] テンプレートファイルがバックエンドに存在する（デフォルトテンプレート）

## テスト実行方法

Claudeに以下のように指示してください：

```
このファイルのテストケースを順番に実行してください。
各テストケースの実行結果をチェックボックスで記録してください。
```

---

## 6.1 画面表示テスト

### テストケース 6.1.1: テンプレート一覧の表示

**目的**: テンプレート管理画面にアクセスすると、左カラムにテンプレート一覧が表示されることを確認する

**手順**:
1. http://localhost:5173/templates にアクセス
2. ページスナップショットを取得
3. テンプレート一覧を確認

**期待結果**:
- 左カラムにテンプレート一覧が表示される
- AWS/Azureのリソースタイプごとにテンプレートが列挙される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_navigate({ url: "http://localhost:5173/templates" })
2. mcp__playwright__browser_snapshot({})
3. テンプレート一覧セクションを探す
4. 複数のテンプレート項目が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.1.2: テンプレート未選択時のメッセージ表示

**目的**: 初期表示時（テンプレート未選択時）、適切なメッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. メインエリアのメッセージを確認

**期待結果**:
- 「テンプレートを選択してください」または類似のメッセージが表示される
- エディタは表示されていない

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "テンプレートを選択してください" テキストを探す
3. エディタが非表示であることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 6.2 テンプレート選択テスト

### テストケース 6.2.1: テンプレートのクリック

**目的**: テンプレート一覧からテンプレートをクリックすると、選択状態になることを確認する

**手順**:
1. 前のテストの続きから
2. テンプレート一覧から1つのテンプレート（例: aws/user.tf.j2）をクリック
3. ページスナップショットを取得

**期待結果**:
- クリックしたテンプレートがハイライト表示される
- 選択されたテンプレート名が明確に表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. テンプレート一覧から "aws/user.tf.j2" などをクリック
   mcp__playwright__browser_click({ element: "aws/user.tf.j2 テンプレート", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 0.5 })
4. mcp__playwright__browser_snapshot({})
5. テンプレートがハイライトされていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.2.2: エディタへの内容読み込み

**目的**: テンプレートを選択すると、その内容がエディタに読み込まれることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. エディタの内容を確認

**期待結果**:
- Monaco Editorが表示される
- 選択したテンプレートの内容が表示される
- Jinja2構文（例: `{{ user_name }}`）が含まれている

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エディタエリアを探す
3. テンプレート内容が表示されることを確認（Jinja2変数やリソース定義等）
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.2.3: カスタム/デフォルト表示

**目的**: 各テンプレートの状態（カスタム/デフォルト）が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. テンプレート一覧またはエディタヘッダーの状態表示を確認

**期待結果**:
- テンプレートが「デフォルト」または「カスタム」として表示される
- 初期状態では「デフォルト」と表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "デフォルト" または "カスタム" ラベルを探す
3. 初期表示が "デフォルト" であることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 6.3 テンプレートエディタテスト

### テストケース 6.3.1: Monaco Editorの表示

**目的**: Monaco Editorが正しく表示されることを確認する

**手順**:
1. 前のテストの続きから（テンプレート選択済み）
2. ページスナップショットを取得
3. Monaco Editorコンポーネントを確認

**期待結果**:
- Monaco Editorが表示される
- エディタに行番号が表示される
- スクロールバーが機能する

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. Monaco Editorエリアを確認
3. エディタの表示を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.3.2: シンタックスハイライト

**目的**: HCL/Jinja2構文がシンタックスハイライトされることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. エディタ内のコードの色分けを確認

**期待結果**:
- Jinja2変数（例: `{{ variable }}`）が色付けされる
- HCLキーワード（例: `resource`, `locals`）が色付けされる
- コメントが別の色で表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エディタ内のシンタックスハイライトを視覚的に確認
3. Jinja2構文とHCL構文が適切に色付けされていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: シンタックスハイライトは視覚的な確認が必要です。

---

### テストケース 6.3.3: 編集内容の入力

**目的**: テンプレート内容を編集できることを確認する

**手順**:
1. 前のテストの続きから
2. エディタ内のテキストを選択
3. テキストを入力または変更
4. ページスナップショットを取得

**期待結果**:
- エディタ内のテキストを編集できる
- 編集内容が即座に反映される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エディタ内をクリック
   mcp__playwright__browser_click({ element: "Monaco Editor", ref: "..." })
3. テキストを入力
   mcp__playwright__browser_type({ element: "Monaco Editor", ref: "...", text: "# Test comment" })
4. mcp__playwright__browser_snapshot({})
5. 入力したテキストが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 6.4 リアルタイムバリデーションテスト

### テストケース 6.4.1: 正しい構文入力時

**目的**: 正しいJinja2構文を入力しても、エラーが表示されないことを確認する

**手順**:
1. 前のテストの続きから
2. 正しいJinja2構文を入力（例: `{{ user_name }}`）
3. 500ms以上待機（デバウンス）
4. ページスナップショットを取得

**期待結果**:
- バリデーションエラーが表示されない
- エディタ内にエラーマーカーが表示されない

**実行**:
```
# 実装コマンド例
1. エディタに正しい構文を入力
2. mcp__playwright__browser_wait_for({ time: 1 })
3. mcp__playwright__browser_snapshot({})
4. エラーメッセージが表示されていないことを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.4.2: Jinja2構文エラー時

**目的**: 不正なJinja2構文を入力すると、エラーメッセージが表示されることを確認する

**手順**:
1. テンプレートを選択
2. エディタに不正なJinja2構文を入力（例: `{{ unclosed_variable`）
3. 500ms以上待機（デバウンス）
4. ページスナップショットを取得

**期待結果**:
- バリデーションエラーメッセージが表示される
- エラーの種類が「jinja2」と表示される
- エラー内容が明確に記載される

**実行**:
```
# 実装コマンド例
1. エディタ内容をクリア
2. 不正な構文を入力
   mcp__playwright__browser_type({ element: "Monaco Editor", ref: "...", text: "{{ unclosed_variable" })
3. mcp__playwright__browser_wait_for({ time: 1 })
4. mcp__playwright__browser_snapshot({})
5. エラーメッセージセクションを探す
6. "[jinja2]" エラーが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.4.3: エラー行のマーカー表示

**目的**: エラーが発生すると、エディタ内でエラー行がハイライトされることを確認する

**手順**:
1. 前のテストの続きから（Jinja2構文エラーがある状態）
2. ページスナップショットを取得
3. エディタ内のエラーマーカーを確認

**期待結果**:
- エラー行に赤い波線または下線が表示される
- 行番号の左側にエラーアイコンが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エディタ内のエラーマーカーを視覚的に確認
3. エラー行がハイライトされていることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: エラーマーカーの表示は視覚的な確認が必要です。

---

### テストケース 6.4.4: エラークリックでジャンプ

**目的**: エラーリストのエラーをクリックすると、該当行に移動することを確認する

**手順**:
1. 前のテストの続きから（エラーが表示されている状態）
2. エラーメッセージリストのエラーをクリック
3. ページスナップショットを取得

**期待結果**:
- エディタのカーソルがエラー行に移動する
- エラー行が画面中央に表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. エラーメッセージをクリック
   mcp__playwright__browser_click({ element: "エラーメッセージ", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 0.5 })
4. mcp__playwright__browser_snapshot({})
5. エディタのカーソル位置が変わったことを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.4.5: デバウンス動作

**目的**: 入力完了後500msでバリデーションが実行されることを確認する（連続入力中は実行されない）

**手順**:
1. テンプレートを選択
2. 短時間で複数文字を連続入力
3. 500ms待機
4. ページスナップショットを取得

**期待結果**:
- 入力中はバリデーションが実行されない
- 入力完了後500ms経過後にバリデーションが実行される

**実行**:
```
# 実装コマンド例
1. エディタに連続で文字を入力
2. mcp__playwright__browser_wait_for({ time: 0.3 })
3. この時点ではバリデーション実行されていないことを確認
4. mcp__playwright__browser_wait_for({ time: 0.5 })
5. mcp__playwright__browser_snapshot({})
6. バリデーション結果が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

**備考**: デバウンスのタイミングは厳密な確認が難しい場合があります。

---

## 6.5 プレビューテスト

### テストケース 6.5.1: プレビューボタンのクリック

**目的**: プレビューボタンをクリックすると、プレビューが生成されることを確認する

**手順**:
1. 正しいテンプレート内容が表示されている状態から
2. "プレビュー" ボタンを探す
3. ボタンをクリック
4. ページスナップショットを取得

**期待結果**:
- ボタンのテキストが「プレビュー中...」に変わる
- ローディング状態が表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "プレビュー" ボタンをクリック
   mcp__playwright__browser_click({ element: "プレビュー button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 0.5 })
4. mcp__playwright__browser_snapshot({})
5. ローディング状態を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.5.2: プレビュー結果の表示

**目的**: プレビューが完了すると、レンダリング結果が表示されることを確認する

**手順**:
1. 前のテストの続きから
2. プレビュー完了まで待機
3. ページスナップショットを取得
4. プレビュー結果を確認

**期待結果**:
- プレビュー結果セクションが表示される
- Jinja2変数がサンプル値でレンダリングされている
- 生成されたTerraformコードが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_wait_for({ time: 2 })
2. mcp__playwright__browser_snapshot({})
3. プレビュー結果エリアを探す
4. レンダリング結果が表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.5.3: プレビュー中のローディング表示

**目的**: プレビュー実行中、ローディング状態が表示されることを確認する

**手順**:
1. テンプレートを選択
2. プレビューボタンをクリック
3. すぐにページスナップショットを取得

**期待結果**:
- ローディングスピナーが表示される
- プレビューボタンが無効化される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_click({ element: "プレビュー button", ref: "..." })
2. mcp__playwright__browser_wait_for({ time: 0.3 })
3. mcp__playwright__browser_snapshot({})
4. ローディング状態を確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.5.4: プレビュー失敗時のエラー表示

**目的**: プレビューが失敗すると、エラーメッセージが表示されることを確認する

**手順**:
1. 不正なテンプレート構文を入力
2. プレビューボタンをクリック
3. プレビュー処理完了まで待機
4. ページスナップショットを取得

**期待結果**:
- エラーメッセージが表示される
- プレビュー結果は表示されない

**実行**:
```
# 実装コマンド例
1. エディタに不正な構文を入力
2. mcp__playwright__browser_click({ element: "プレビュー button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 2 })
4. mcp__playwright__browser_snapshot({})
5. エラーメッセージを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## 6.6 保存・復元テスト

### テストケース 6.6.1: 保存ボタンのクリック

**目的**: 保存ボタンをクリックすると、テンプレートが保存されることを確認する

**手順**:
1. テンプレートを選択し、内容を編集
2. "保存" ボタンを探す
3. ボタンをクリック
4. ページスナップショットを取得

**期待結果**:
- 保存処理が実行される
- ボタンが一時的に無効化される

**実行**:
```
# 実装コマンド例
1. テンプレート内容を編集
2. mcp__playwright__browser_snapshot({})
3. "保存" ボタンをクリック
   mcp__playwright__browser_click({ element: "保存 button", ref: "..." })
4. mcp__playwright__browser_wait_for({ time: 1 })
5. mcp__playwright__browser_snapshot({})
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.2: 保存成功メッセージ表示

**目的**: 保存が成功すると、成功メッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 成功メッセージを確認

**期待結果**:
- 成功メッセージ「テンプレートを保存しました」が表示される
- メッセージが数秒後に自動的に消える

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "テンプレートを保存しました" テキストを探す
3. 成功メッセージが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.3: 保存後のカスタム表示

**目的**: テンプレートを保存すると、「カスタム」表示に変わることを確認する

**手順**:
1. 前のテストの続きから（保存完了後）
2. ページスナップショットを取得
3. テンプレートの状態表示を確認

**期待結果**:
- テンプレートの状態が「カスタム」に変わる
- テンプレート一覧またはエディタヘッダーに「カスタム」と表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "カスタム" ラベルを探す
3. 状態が "デフォルト" から "カスタム" に変わったことを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.4: デフォルトに復元ボタンの表示

**目的**: カスタムテンプレートにのみ「デフォルトに復元」ボタンが表示されることを確認する

**手順**:
1. 前のテストの続きから（カスタム状態のテンプレート）
2. ページスナップショットを取得
3. デフォルトに復元ボタンを確認

**期待結果**:
- 「デフォルトに復元」ボタンが表示される
- デフォルトテンプレートには復元ボタンが表示されない

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "デフォルトに復元" ボタンを探す
3. ボタンが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.5: デフォルトに復元の確認ダイアログ表示

**目的**: デフォルトに復元ボタンをクリックすると、確認ダイアログが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. "デフォルトに復元" ボタンをクリック
3. ページスナップショットを取得

**期待結果**:
- 確認ダイアログまたはconfirmが表示される
- 「本当に復元しますか?」などのメッセージが表示される

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "デフォルトに復元" ボタンをクリック
   mcp__playwright__browser_click({ element: "デフォルトに復元 button", ref: "..." })
3. mcp__playwright__browser_wait_for({ time: 0.5 })
4. mcp__playwright__browser_snapshot({})
5. 確認ダイアログを探す
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.6: デフォルトに復元の実行

**目的**: 確認ダイアログで「OK」を選択すると、テンプレートがデフォルトに戻ることを確認する

**手順**:
1. 前のテストの続きから（確認ダイアログ表示中）
2. 確認ダイアログで「OK」をクリック（ブラウザのdialog処理）
3. ページスナップショットを取得
4. テンプレート内容を確認

**期待結果**:
- テンプレート内容がデフォルトに戻る
- カスタム編集内容が破棄される
- 状態が「デフォルト」に戻る

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_handle_dialog({ accept: true })
2. mcp__playwright__browser_wait_for({ time: 1 })
3. mcp__playwright__browser_snapshot({})
4. テンプレート内容がデフォルトに戻ったことを確認
5. 状態が "デフォルト" に戻ったことを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

### テストケース 6.6.7: 復元成功メッセージ表示

**目的**: デフォルトへの復元が成功すると、成功メッセージが表示されることを確認する

**手順**:
1. 前のテストの続きから
2. ページスナップショットを取得
3. 成功メッセージを確認

**期待結果**:
- 成功メッセージ「デフォルトに復元しました」が表示される
- メッセージが数秒後に自動的に消える

**実行**:
```
# 実装コマンド例
1. mcp__playwright__browser_snapshot({})
2. "デフォルトに復元しました" テキストを探す
3. 成功メッセージが表示されることを確認
```

**結果**: [ ] 成功 / [ ] 失敗

---

## テスト完了後のクリーンアップ

すべてのテストケースを実行した後、以下のクリーンアップを実行してください：

1. ブラウザを閉じる
```
mcp__playwright__browser_close()
```

2. 開発環境の停止（必要に応じて）
```bash
# バックエンド/フロントエンドのプロセスを停止
Ctrl+C
```

---

## テスト結果サマリー

### 実行日時
- 実行日:
- 実行者:

### 結果統計
- 総テストケース数: 19
- 成功:
- 失敗:
- スキップ:

### 備考・課題
（テスト実行中に発見した問題や改善点をここに記載）

---

最終更新: 2026-01-03
