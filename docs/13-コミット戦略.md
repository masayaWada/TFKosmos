# 13. コミット戦略

## 13.1 コミットメッセージの形式

本プロジェクトでは、[Conventional Commits](https://www.conventionalcommits.org/) の規約に準拠したコミットメッセージを使用します。

### 基本形式

```
<type>(<scope>): <subject>

<body>

<footer>
```

### コミットタイプ（type）

コミットメッセージの先頭に、以下のいずれかのタイプを指定します。

- **feat**: 新機能の追加
- **fix**: バグ修正
- **docs**: ドキュメントのみの変更
- **style**: コードの動作に影響しない変更（フォーマット、セミコロンの欠落など）
- **refactor**: バグ修正や機能追加を伴わないコードのリファクタリング
- **perf**: パフォーマンス改善
- **test**: テストの追加・修正
- **chore**: ビルドプロセスやツールの変更（依存関係の更新など）
- **ci**: CI設定の変更
- **build**: ビルドシステムや外部依存関係の変更

### スコープ（scope）

オプション。変更が影響する範囲を指定します。

- `backend`: バックエンド（Rust）の変更
- `frontend`: フロントエンド（React）の変更
- `api`: API設計の変更
- `ui`: UI/UXの変更
- `docs`: ドキュメントの変更
- `config`: 設定ファイルの変更

### 件名（subject）

- 50文字以内で簡潔に記述
- 命令形で記述（例: "追加する" ではなく "追加"）
- 文末にピリオドを付けない
- 日本語で記述

### 本文（body）

- オプション。変更の理由や背景を説明
- 72文字で折り返す
- 箇条書きで記述可能

### フッター（footer）

- オプション。関連するイシューや破壊的変更を記載
- `Closes #123` や `BREAKING CHANGE:` など

## 13.2 コミットメッセージの例

### 新機能の追加

```
feat(backend): AWS IAMスキャン機能の追加

- IAMユーザー、グループ、ロール、ポリシーのスキャン機能を実装
- 非同期処理によるパフォーマンス改善
- フィルタリング機能を追加

Closes #10
```

### バグ修正

```
fix(frontend): UTF-8文字列のバイト位置スライスによるパニックを修正

文字列のスライス時に文字境界を考慮せずにバイト位置で
スライスしていたため、マルチバイト文字を含む場合に
パニックが発生する問題を修正。

Fixes #25
```

### リファクタリング

```
refactor(backend): scan_with_progressをscanにリネーム

未使用のコードを削除し、メソッド名をより簡潔に変更。
機能的な変更はなし。
```

### ドキュメントの更新

```
docs: コミット戦略ドキュメントの追加

コミットメッセージ、イシュー、PRのテンプレートを追加。
```

### プロジェクト名の変更

```
chore: プロジェクト名をTFKosmosに変更

- パッケージ名の更新（backend: tfkosmos, frontend: tfkosmos-ui）
- UIタイトルとナビゲーションラベルの更新
- APIレスポンスメッセージの更新
- ドキュメントの更新
```

## 13.3 コミットメッセージの雛形

### 新機能追加時

```
feat(<scope>): <機能名>の追加

- <実装内容1>
- <実装内容2>
- <実装内容3>

Closes #<issue番号>
```

### バグ修正時

```
fix(<scope>): <問題の概要>を修正

<問題の詳細説明>

Fixes #<issue番号>
```

### リファクタリング時

```
refactor(<scope>): <変更内容>のリファクタリング

<変更理由や背景>

関連: #<issue番号>
```

### ドキュメント更新時

```
docs: <更新内容>のドキュメント追加/更新

<更新内容の詳細>
```

### 設定変更時

```
chore(<scope>): <変更内容>の設定変更

<変更内容の詳細>
```

## 13.4 コミットのベストプラクティス

1. **1つのコミットに1つの変更**: 関連する変更は1つのコミットにまとめ、無関係な変更は分離する
2. **コミット前にテスト**: コミット前にローカルでテストを実行し、問題がないことを確認する
3. **意味のあるコミット**: コミットメッセージから変更内容が理解できるようにする
4. **定期的なコミット**: 小さな変更でも定期的にコミットし、作業履歴を残す
5. **レビューしやすいコミット**: PRでレビューしやすいように、論理的な単位でコミットを分割する

## 13.5 ブランチ戦略

- **main**: 本番環境用のブランチ。常に安定した状態を保つ
- **develop**: 開発用のブランチ。機能追加やバグ修正を統合
- **feature/**: 新機能開発用ブランチ（例: `feature/add-gcp-support`）
- **fix/**: バグ修正用ブランチ（例: `fix/utf8-slice-panic`）
- **docs/**: ドキュメント更新用ブランチ（例: `docs/add-commit-strategy`）
- **refactor/**: リファクタリング用ブランチ（例: `refactor/scan-service`）

## 13.6 イシューとPRのテンプレート

イシューとPRのテンプレートは、`.github/` ディレクトリに配置されています。

- イシューテンプレート: `.github/ISSUE_TEMPLATE/`
- PRテンプレート: `.github/pull_request_template.md`

詳細は各テンプレートファイルを参照してください。

---
