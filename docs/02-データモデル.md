# 2. データモデル

### 2.1 AWS IAM ドメインモデル

#### IAMUser

```python
class IAMUser:
    user_name: str
    user_id: str
    arn: str
    path: str
    create_date: datetime
    tags: Dict[str, str]
    attached_policies: List[str]  # Policy ARNs
    inline_policies: List[Dict]  # Policy名とDocument
    groups: List[str]  # Group名
    access_keys: List[AccessKey]
    login_profile: Optional[LoginProfile]
    mfa_devices: List[MFADevice]
```

#### IAMGroup

```python
class IAMGroup:
    group_name: str
    group_id: str
    arn: str
    path: str
    create_date: datetime
    tags: Dict[str, str]
    attached_policies: List[str]  # Policy ARNs
    inline_policies: List[Dict]
    members: List[str]  # User名
```

#### IAMRole

```python
class IAMRole:
    role_name: str
    role_id: str
    arn: str
    path: str
    assume_role_policy_document: Dict
    create_date: datetime
    tags: Dict[str, str]
    attached_policies: List[str]  # Policy ARNs
    inline_policies: List[Dict]
    instance_profiles: List[str]
```

#### IAMPolicy (カスタム)

```python
class IAMPolicy:
    policy_name: str
    policy_id: str
    arn: str
    path: str
    default_version_id: str
    policy_document: Dict
    create_date: datetime
    update_date: datetime
    tags: Dict[str, str]
    attachment_count: int
```

#### PolicyAttachment

```python
class PolicyAttachment:
    policy_arn: str
    target_type: str  # "user", "group", "role"
    target_name: str
    attachment_id: str  # 一意ID生成用
```

#### GroupMembership

```python
class GroupMembership:
    group_name: str
    user_name: str
    membership_id: str  # 一意ID生成用
```

#### AccessKey (Cleanup用)

```python
class AccessKey:
    access_key_id: str
    user_name: str
    status: str  # "Active", "Inactive"
    create_date: datetime
    # secret_access_key は取得しない
```

#### LoginProfile (Cleanup用)

```python
class LoginProfile:
    user_name: str
    password_reset_required: bool
    create_date: datetime
    # password は取得しない
```

#### MFADevice (Cleanup用)

```python
class MFADevice:
    serial_number: str
    user_name: str
    device_type: str  # "virtual", "hardware"
    enable_date: datetime
    # seed は取得しない
```

### 2.2 Azure IAM ドメインモデル

#### AzureRoleDefinition

```python
class AzureRoleDefinition:
    role_definition_id: str
    name: str
    role_name: str
    description: str
    role_type: str  # "CustomRole"
    assignable_scopes: List[str]
    permissions: List[Dict]  # actions, not_actions, data_actions, etc.
    subscription_id: str
    scope: str  # Management Group / Subscription / Resource Group
```

#### AzureRoleAssignment

```python
class AzureRoleAssignment:
    assignment_id: str
    role_definition_id: str
    role_definition_name: str
    principal_id: str
    principal_type: str  # "User", "ServicePrincipal", "Group"
    scope: str
    subscription_id: str
```

### 2.3 スキャン設定モデル

#### ScanConfig (AWS)

```python
class ScanConfig:
    provider: str  # "aws"
    account_id: Optional[str]
    profile: Optional[str]
    assume_role_arn: Optional[str]
    assume_role_session_name: Optional[str]
    scan_targets: Dict[str, bool]  # {"users": True, "groups": True, ...}
    filters: Dict[str, str]  # {"name_prefix": "...", "tags": "..."}
```

#### ScanConfig (Azure)

```python
class ScanConfig:
    provider: str  # "azure"
    subscription_id: str
    tenant_id: Optional[str]
    auth_method: str  # "az_login", "service_principal"
    service_principal_config: Optional[Dict]
    scope_type: str  # "management_group", "subscription", "resource_group"
    scope_value: str
    scan_targets: Dict[str, bool]  # {"role_definitions": True, "role_assignments": True}
```

### 2.4 生成設定モデル

#### GenerationConfig

```python
class GenerationConfig:
    output_path: str
    file_split_rule: str  # "single", "by_resource_type", "by_resource_name"
    naming_convention: str  # "snake_case", "kebab-case", "original"
    import_script_format: str  # "sh", "ps1"
    generate_readme: bool
    selected_resources: Dict[str, List[str]]  # {"users": ["user1", "user2"], ...}
```

---

