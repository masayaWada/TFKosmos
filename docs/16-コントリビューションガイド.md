# 16. コントリビューションガイド

TFKosmosへのコントリビューションを歓迎します。このガイドでは、プロジェクトへの貢献方法を説明します。

---

## 16.1 開発環境のセットアップ

### 必要なツール

| ツール | バージョン | 用途 |
|--------|----------|------|
| Rust | 1.70+ | バックエンド開発 |
| Node.js | 18+ | フロントエンド開発 |
| npm | 9+ | パッケージ管理 |
| Git | 2.0+ | バージョン管理 |

### セットアップ手順

```bash
# 1. リポジトリをクローン
git clone https://github.com/masayaWada/TFKosmos.git
cd TFKosmos

# 2. Rustのインストール（未インストールの場合）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# 3. バックエンドの依存関係をインストール
cd backend
cargo build

# 4. フロントエンドの依存関係をインストール
cd ../frontend
npm install

# 5. 開発サーバーを起動
cd ..
make dev
```

### 動作確認

- バックエンド: http://localhost:8000
- フロントエンド: http://localhost:5173

---

## 16.2 コーディング規約

### Rust（バックエンド）

#### 命名規則

| 対象 | 規則 | 例 |
|------|------|-----|
| モジュール/ファイル | snake_case | `scan_service.rs` |
| 構造体/列挙型/トレイト | PascalCase | `ScanService`, `ApiError` |
| 関数/メソッド | snake_case | `scan_users()`, `get_config()` |
| 定数 | SCREAMING_SNAKE_CASE | `MAX_RETRY_COUNT` |
| 変数 | snake_case | `user_name`, `scan_result` |

#### フォーマットとLint

```bash
cd backend

# フォーマット
cargo fmt

# Lintチェック
cargo clippy -- -D warnings
```

#### ドキュメントコメント

```rust
/// ユーザーをスキャンして結果を返す
///
/// # Arguments
/// * `config` - スキャン設定
///
/// # Returns
/// スキャン結果のベクター
///
/// # Errors
/// AWS APIへの接続に失敗した場合
pub async fn scan_users(&self, config: &ScanConfig) -> Result<Vec<User>> {
    // ...
}
```

### TypeScript/React（フロントエンド）

#### 命名規則

| 対象 | 規則 | 例 |
|------|------|-----|
| コンポーネントファイル | PascalCase | `ScanPage.tsx` |
| ユーティリティファイル | camelCase | `apiClient.ts` |
| Reactコンポーネント | PascalCase | `function ScanPage()` |
| 関数 | camelCase | `fetchResources()` |
| 変数/定数 | camelCase | `scanResult`, `apiEndpoint` |
| グローバル定数 | SCREAMING_SNAKE_CASE | `API_BASE_URL` |
| インターフェース/型 | PascalCase | `ScanConfig`, `User` |

#### フォーマットとLint

```bash
cd frontend

# Lintチェック
npx eslint src/

# 自動修正
npx eslint src/ --fix
```

#### コンポーネント構造

```tsx
import { useState, useEffect } from 'react';

interface Props {
  title: string;
  onSubmit: (data: FormData) => void;
}

export default function MyComponent({ title, onSubmit }: Props) {
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // 副作用の処理
  }, []);

  const handleSubmit = () => {
    // イベントハンドラ
  };

  return (
    <div>
      <h1>{title}</h1>
      {/* JSX */}
    </div>
  );
}
```

---

## 16.3 ブランチ戦略

### ブランチ命名規則

| タイプ | パターン | 例 |
|--------|---------|-----|
| 機能追加 | `feature/機能名` | `feature/gcp-support` |
| バグ修正 | `fix/issue番号-説明` | `fix/123-cors-error` |
| ドキュメント | `docs/説明` | `docs/update-readme` |
| リファクタリング | `refactor/説明` | `refactor/scan-service` |

### ワークフロー

```bash
# 1. mainブランチを最新化
git checkout main
git pull origin main

# 2. 作業ブランチを作成
git checkout -b feature/my-feature

# 3. 変更をコミット
git add .
git commit -m "feat: 新機能の説明"

# 4. リモートにプッシュ
git push -u origin feature/my-feature

# 5. プルリクエストを作成
```

---

## 16.4 コミットメッセージ規約

[Conventional Commits](https://www.conventionalcommits.org/) に従います。

### フォーマット

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

### タイプ

| タイプ | 説明 |
|--------|------|
| `feat` | 新機能 |
| `fix` | バグ修正 |
| `docs` | ドキュメントのみの変更 |
| `style` | フォーマット、セミコロン等（コードの動作に影響なし） |
| `refactor` | リファクタリング（機能追加でもバグ修正でもない） |
| `test` | テストの追加・修正 |
| `chore` | ビルドプロセスやツールの変更 |

### 例

```bash
# 機能追加
git commit -m "feat(scanner): GCPスキャン機能を追加"

# バグ修正
git commit -m "fix(api): CORSエラーを修正"

# ドキュメント
git commit -m "docs: README.mdを更新"

# リファクタリング
git commit -m "refactor(frontend): コンポーネントをメモ化"
```

---

## 16.5 プルリクエストの作成

### PRテンプレート

```markdown
## 概要
<!-- 変更内容を簡潔に説明 -->

## 変更タイプ
- [ ] 新機能
- [ ] バグ修正
- [ ] ドキュメント更新
- [ ] リファクタリング
- [ ] その他

## 変更内容
<!-- 具体的な変更点をリスト -->
-
-

## テスト
<!-- テスト方法を記載 -->
- [ ] 単体テストを追加/更新
- [ ] 手動テストを実施

## スクリーンショット（該当する場合）
<!-- UI変更がある場合はスクリーンショットを添付 -->

## チェックリスト
- [ ] コードがフォーマットされている（`cargo fmt`, `eslint`）
- [ ] Lintエラーがない（`cargo clippy`, `eslint`）
- [ ] テストが通っている（`cargo test`, `npm test`）
- [ ] ドキュメントを更新した（必要な場合）
```

### PRの粒度

- **1つのPRは1つの機能/修正に限定**
- 大きな変更は複数のPRに分割
- レビューしやすいサイズ（目安: 500行以下）

---

## 16.6 レビュープロセス

### レビュー観点

1. **機能要件**
   - 要件を満たしているか
   - エッジケースは考慮されているか

2. **コード品質**
   - コーディング規約に従っているか
   - 適切な命名がされているか
   - 重複コードはないか

3. **テスト**
   - テストは十分か
   - テストケースは適切か

4. **セキュリティ**
   - 機密情報が含まれていないか
   - 入力バリデーションは適切か

5. **パフォーマンス**
   - 非効率な処理はないか
   - N+1問題はないか

### レビューコメントの種類

| プレフィックス | 意味 |
|--------------|------|
| `[must]` | 修正必須 |
| `[should]` | 修正推奨 |
| `[nit]` | 細かい指摘（任意） |
| `[question]` | 質問・確認 |

---

## 16.7 テスト

### テストの追加

新機能やバグ修正には、対応するテストを追加してください。

#### バックエンド

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_feature_works() {
        // Arrange
        let input = "test";

        // Act
        let result = my_function(input);

        // Assert
        assert_eq!(result, "expected");
    }
}
```

#### フロントエンド

```typescript
import { describe, it, expect } from 'vitest';
import { render, screen } from '../test/utils';
import MyComponent from './MyComponent';

describe('MyComponent', () => {
  it('should render correctly', () => {
    render(<MyComponent title="Test" />);
    expect(screen.getByText('Test')).toBeInTheDocument();
  });
});
```

### テストの実行

```bash
# バックエンド
cd backend && cargo test

# フロントエンド
cd frontend && npm test
```

---

## 16.8 コントリビューション歓迎領域

以下の領域でコントリビューションを特に歓迎しています：

### 優先度: 高

- [ ] GCPサポートの追加
- [ ] 追加AWSリソース（VPC, S3, EC2等）
- [ ] テストカバレッジの向上

### 優先度: 中

- [ ] ドキュメントの翻訳（英語）
- [ ] UIの改善
- [ ] エラーメッセージの改善

### 優先度: 低

- [ ] パフォーマンス最適化
- [ ] アクセシビリティ対応
- [ ] ダークモード対応

---

## 16.9 質問・サポート

- **Issue**: バグ報告や機能リクエストは [GitHub Issues](https://github.com/masayaWada/TFKosmos/issues) へ
- **Discussion**: 質問や議論は [GitHub Discussions](https://github.com/masayaWada/TFKosmos/discussions) へ

---
