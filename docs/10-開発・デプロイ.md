# 10. 開発・デプロイ

### 10.1 開発環境セットアップ

```bash
# Rustのインストール（未インストールの場合）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
# または https://rustup.rs/ からインストール

# Rustのバージョン確認
rustc --version

# 注意: cargoコマンドが見つからない場合、以下を実行してください
# source ~/.cargo/env

# Backend（依存関係は初回ビルド時に自動インストール）
cd backend
cargo build

# Frontend
cd frontend
npm install
```

**注意**: 新しいターミナルセッションでは、`source ~/.cargo/env`を実行するか、シェルの設定ファイル（`.zshrc`や`.bashrc`）に以下を追加してください：

```bash
source "$HOME/.cargo/env"
```

### 10.2 実行方法

#### 方法1: 同時起動（推奨）

フロントエンドとバックエンドを同時に起動：

```bash
# Makefileを使用（推奨）
make dev

# またはシェルスクリプトを使用
./dev.sh

# またはCursor/VS Codeのタスクを使用
# Cmd+Shift+P → "Tasks: Run Task" → "dev: フロントエンド + バックエンド"
```

#### 方法2: 個別に起動

```bash
# 注意: cargoコマンドが見つからない場合、先に以下を実行してください
# source ~/.cargo/env

# Backend起動（開発モード）
cd backend
cargo run

# Backend起動（リリースモード、最適化済み）
cd backend
cargo run --release

# Frontend起動
cd frontend
npm run dev
```

**起動後のURL:**
- バックエンド: `http://0.0.0.0:8000`
- フロントエンド: `http://localhost:5173`

### 10.3 依存関係

#### Backend (Cargo.toml)

```toml
[dependencies]
# Web framework
axum = { version = "0.7", features = ["macros", "multipart"] }
tokio = { version = "1", features = ["full"] }
tower = "0.4"
tower-http = { version = "0.5", features = ["cors", "trace"] }
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# AWS SDK
aws-sdk-iam = "1"
aws-config = "1"
aws-sdk-sts = "1"

# Azure SDK
azure_identity = "0.30"
azure_core = "0.30"
reqwest = { version = "0.11", features = ["json"] }

# Template engine
minijinja = "1.0"

# Utilities
anyhow = "1.0"
thiserror = "1.0"
uuid = { version = "1.0", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
zip = "0.6"
futures = "0.3"
lazy_static = "1.4"
```

#### Frontend (package.json)

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "axios": "^1.6.2",
    "@monaco-editor/react": "^4.6.0"
  }
}
```

### 10.4 デプロイ・配布方法

#### Tauriビルド＆署名（自動アップデート対応）

TFKosmosは、Tauriを使用してデスクトップアプリケーションとして配布できます。Tauri統合は完了しており、`deployment/src-tauri/`ディレクトリに設定ファイルが含まれています。

##### ビルド形式

- **Windows**: MSI形式で配布
- **macOS**: DMG形式で配布

##### 署名と自動アップデート

- コード署名に対応し、セキュアな配布を実現
- 自動アップデート機能を実装し、ユーザーが最新版を簡単に取得できるようにする

##### ビルド手順

```bash
# Tauri CLIのインストール（グローバル、またはdevDependenciesに含まれています）
npm install -g @tauri-apps/cli

# フロントエンドの依存関係をインストール
cd frontend
npm install

# デスクトップアプリの開発モードで実行
cd ../deployment
npm run dev

# デスクトップアプリのビルド
npm run build

# プラットフォーム別のビルド
# Windows (MSI)
cd src-tauri
cargo tauri build --target x86_64-pc-windows-msvc

# macOS (DMG)
cargo tauri build --target x86_64-apple-darwin
cargo tauri build --target aarch64-apple-darwin
```

**注意**: Tauriアプリを実行すると、バックエンドAPIサーバーも自動的に起動します（`deployment/src-tauri/src/main.rs`で実装）。

##### 署名設定（予定）

- **Windows**: Authenticode署名（コード署名証明書が必要）
- **macOS**: Apple Developer ID証明書を使用した署名

##### 自動アップデート設定（予定）

- Tauriの自動アップデート機能を有効化
- アップデートサーバーの設定
- バージョン管理とリリースプロセスの整備

---

