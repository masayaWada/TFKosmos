# 1. システムアーキテクチャ

### 1.1 全体構成

```bash
┌─────────────────────────────────────────────────────────┐
│                   ローカルブラウザ (React)                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │ 接続設定  │  │ スキャン  │  │ リソース  │  │ 生成    │ │
│  │   画面    │  │   画面    │  │  一覧    │  │  画面   │ │
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │
└──────────────────────┬──────────────────────────────────┘
                       │ HTTP/REST API
┌──────────────────────┴──────────────────────────────────┐
│              Axum Backend (Rust)                         │
│  ┌──────────────────────────────────────────────────┐   │
│  │          API Routes (src/api/routes/)             │   │
│  │  - /api/connection/*                              │   │
│  │  - /api/scan/*                                    │   │
│  │  - /api/resources/*                               │   │
│  │  - /api/generate/*                                │   │
│  │  - /api/templates/*                               │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │        Services Layer (src/services/)             │   │
│  │  - ConnectionService                              │   │
│  │  - ScanService                                    │   │
│  │  - ResourceService                                │   │
│  │  - GenerationService                              │   │
│  │  - TemplateService                                │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │        Domain Models (src/domain/)                │   │
│  │  - IAMUser, IAMGroup, IAMRole, IAMPolicy         │   │
│  │  - PolicyAttachment, GroupMembership              │   │
│  │  - AccessKey, LoginProfile, MFA                   │   │
│  │  - AzureRoleDefinition, AzureRoleAssignment       │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │        Infrastructure Layer (src/infra/)          │   │
│  │  - Scanner (aws/, azure/)                         │   │
│  │  - TemplateManager                                │   │
│  │  - TerraformGenerator                             │   │
│  └──────────────────────────────────────────────────┘   │
└──────────────────────┬──────────────────────────────────┘
                       │
        ┌──────────────┴──────────────┐
        │                             │
┌───────▼────────┐          ┌─────────▼────────┐
│   AWS API      │          │   Azure API      │
│  (aws-sdk-*)   │          │  (azure-*)       │
└────────────────┘          └──────────────────┘
```

### 1.2 レイヤー責務

#### Presentation Layer (UI)

- React ベースのSPA
- ユーザーインタラクション処理
- API呼び出しとレスポンス表示

#### Application Layer (API)

- Axum ルーティング
- リクエスト/レスポンスのバリデーション（serde）
- エラーハンドリング

#### Service Layer

- ビジネスロジックの実装
- 複数のInfrastructureコンポーネントの協調
- トランザクション管理

#### Domain Layer

- IAMリソースのドメインモデル
- ビジネスルール
- 値オブジェクト

#### Infrastructure Layer

- 外部APIとの通信（AWS/Azure）
- テンプレート管理
- Terraformコード生成

---

