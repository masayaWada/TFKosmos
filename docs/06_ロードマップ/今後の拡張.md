# 12. 今後の拡張

## 12.1 ロードマップ概要

```
フェーズ1: GCPサポート追加
    ↓
フェーズ2: 追加AWSリソース対応
    ↓
フェーズ3: ドリフト検出機能
    ↓
フェーズ4: チーム機能
```

---

## 12.2 フェーズ1: GCPサポート追加

### 目標

Google Cloud Platform (GCP) のIAMリソースをスキャンし、Terraformコードを生成する機能を追加。

### 対象リソース

| GCPリソース | Terraformリソース |
|------------|------------------|
| サービスアカウント | `google_service_account` |
| IAMバインディング | `google_project_iam_binding` |
| IAMメンバー | `google_project_iam_member` |
| カスタムロール | `google_project_iam_custom_role` |
| サービスアカウントキー | `google_service_account_key` |

### 技術的考慮事項

#### バックエンド

```rust
// src/infra/gcp/scanner.rs
pub struct GcpIamScanner {
    client: GcpClient,
    project_id: String,
}

impl GcpIamScanner {
    pub async fn scan_service_accounts(&self) -> Result<Vec<Value>> { ... }
    pub async fn scan_iam_bindings(&self) -> Result<Vec<Value>> { ... }
    pub async fn scan_custom_roles(&self) -> Result<Vec<Value>> { ... }
}
```

#### 認証方法

- サービスアカウントキーファイル
- Application Default Credentials (ADC)
- `gcloud auth login`

#### テンプレート

```
templates_default/terraform/gcp/
├── service_account.tf.j2
├── iam_binding.tf.j2
├── iam_member.tf.j2
└── custom_role.tf.j2
```

### 実装ステップ

1. GCP SDK for Rust のセットアップ
2. `GcpIamScanner` の実装
3. GCP用テンプレートの作成
4. フロントエンドにGCPタブ追加
5. テスト・ドキュメント整備

---

## 12.3 フェーズ2: 追加AWSリソース対応

### 目標

IAM以外の主要AWSリソースへの対応を拡大。

### 対象リソース

#### ネットワーキング

| AWSリソース | Terraformリソース | 優先度 |
|------------|------------------|-------|
| VPC | `aws_vpc` | 高 |
| サブネット | `aws_subnet` | 高 |
| セキュリティグループ | `aws_security_group` | 高 |
| ルートテーブル | `aws_route_table` | 中 |
| NAT Gateway | `aws_nat_gateway` | 中 |
| Internet Gateway | `aws_internet_gateway` | 中 |

#### コンピューティング

| AWSリソース | Terraformリソース | 優先度 |
|------------|------------------|-------|
| EC2インスタンス | `aws_instance` | 高 |
| Auto Scaling Group | `aws_autoscaling_group` | 中 |
| Launch Template | `aws_launch_template` | 中 |

#### ストレージ

| AWSリソース | Terraformリソース | 優先度 |
|------------|------------------|-------|
| S3バケット | `aws_s3_bucket` | 高 |
| S3バケットポリシー | `aws_s3_bucket_policy` | 高 |
| EBSボリューム | `aws_ebs_volume` | 中 |

#### データベース

| AWSリソース | Terraformリソース | 優先度 |
|------------|------------------|-------|
| RDSインスタンス | `aws_db_instance` | 高 |
| DynamoDBテーブル | `aws_dynamodb_table` | 中 |

#### サーバーレス

| AWSリソース | Terraformリソース | 優先度 |
|------------|------------------|-------|
| Lambda関数 | `aws_lambda_function` | 高 |
| API Gateway | `aws_api_gateway_rest_api` | 中 |

### アーキテクチャ設計

```rust
// 拡張可能なスキャナーインターフェース
pub trait ResourceScanner {
    async fn scan(&self, config: &ScanConfig) -> Result<Vec<Value>>;
    fn resource_type(&self) -> &str;
    fn template_name(&self) -> &str;
}

// リソースタイプごとのスキャナー
pub struct VpcScanner { ... }
pub struct S3Scanner { ... }
pub struct LambdaScanner { ... }
```

---

## 12.4 フェーズ3: ドリフト検出機能

### 目標

既存のTerraform stateと実際のクラウドリソースの差分（ドリフト）を検出し、レポートを生成。

### 機能要件

#### 検出対象

- Terraformで管理されていないリソース（未管理リソース）
- Terraformで管理されているが、実際の状態と異なるリソース（ドリフト）
- Terraformで定義されているが、実際には存在しないリソース（孤立リソース）

#### レポート形式

```json
{
  "drift_report": {
    "generated_at": "2024-12-29T10:00:00Z",
    "unmanaged_resources": [
      {
        "resource_type": "aws_iam_user",
        "resource_id": "arn:aws:iam::123456789012:user/manual-user",
        "recommendation": "Import or delete"
      }
    ],
    "drifted_resources": [
      {
        "resource_type": "aws_iam_role",
        "resource_id": "arn:aws:iam::123456789012:role/my-role",
        "expected": { "description": "Original" },
        "actual": { "description": "Modified manually" }
      }
    ],
    "orphaned_resources": [
      {
        "resource_type": "aws_iam_policy",
        "terraform_address": "aws_iam_policy.deleted_policy"
      }
    ]
  }
}
```

### 技術的考慮事項

#### Terraform State解析

```rust
pub struct TerraformStateParser {
    state_file_path: PathBuf,
}

impl TerraformStateParser {
    pub fn parse(&self) -> Result<TerraformState> { ... }
    pub fn get_managed_resources(&self) -> Vec<ManagedResource> { ... }
}
```

#### 差分比較エンジン

```rust
pub struct DriftDetector {
    scanner: Box<dyn ResourceScanner>,
    state_parser: TerraformStateParser,
}

impl DriftDetector {
    pub async fn detect(&self) -> Result<DriftReport> { ... }
}
```

---

## 12.5 フェーズ4: チーム機能

### 目標

チームでの共同作業をサポートする機能を追加。

### 機能要件

#### ユーザー管理

- ユーザー登録・認証
- ロールベースアクセス制御（RBAC）
- チーム/組織の作成・管理

#### スキャン結果の共有

- スキャン結果の保存（永続化）
- 共有リンクの生成
- コメント・レビュー機能

#### テンプレート共有

- チーム共有テンプレート
- テンプレートのバージョン管理
- プライベート/パブリックテンプレート

### 技術的考慮事項

#### データベース

```sql
-- ユーザーテーブル
CREATE TABLE users (
    id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- チームテーブル
CREATE TABLE teams (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- スキャン結果テーブル
CREATE TABLE scan_results (
    id UUID PRIMARY KEY,
    team_id UUID REFERENCES teams(id),
    provider VARCHAR(50) NOT NULL,
    result_data JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 認証・認可

- JWT (JSON Web Token) による認証
- OAuth2/OIDC 統合（GitHub, Google等）
- API キー認証（CI/CD連携用）

---

## 12.6 改善候補

### パフォーマンス改善

| 項目 | 現状 | 改善案 |
|------|-----|-------|
| スキャン結果キャッシュ | メモリ内 | Redis/ファイルシステム |
| 並列スキャン | 逐次実行 | 並列実行（tokio::spawn） |
| テンプレートキャッシュ | 毎回読み込み | メモリキャッシュ |

### UI/UX改善

| 項目 | 改善案 |
|------|-------|
| ダークモード | テーマ切り替え機能 |
| キーボードショートカット | 主要操作のショートカット |
| ドラッグ&ドロップ | リソース選択のD&D |
| 検索・フィルタ | グローバル検索機能 |

### 国際化

| 言語 | ステータス |
|------|----------|
| 日本語 | 実装済み |
| 英語 | 予定 |
| 中国語 | 検討中 |

### その他

- **CLI版**: ヘッドレス実行、CI/CD統合
- **VS Code拡張**: エディタ統合
- **Terraform Cloud連携**: ワークスペース連携

---

## 12.7 コントリビューション歓迎領域

以下の領域でコントリビューションを歓迎しています：

1. **新規クラウドプロバイダー**: GCP, OCI, Alibaba Cloud等
2. **新規リソースタイプ**: EC2, S3, Lambda等
3. **テンプレート改善**: より良いTerraformコード生成
4. **ドキュメント**: 翻訳、チュートリアル
5. **テスト**: カバレッジ向上

---
