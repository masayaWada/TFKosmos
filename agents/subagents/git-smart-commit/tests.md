# git-smart-commit テストケース

## 概要

このドキュメントは、git-smart-commit エージェントのテストケースを定義します。

**テスト方針**:
- 正常系・異常系・エッジケースを網羅
- 実際の使用シナリオに基づくテスト
- 回帰テスト用のチェックリスト

## テストケース一覧

### テストケース1: [正常系] 新機能追加のコミット

**目的**: 新機能追加時のコミットメッセージ生成をテスト

**前提条件**:
- Gitリポジトリが初期化されている
- 新機能のコードがステージングされている（backend/src/services/new_service.rs）
- main ブランチではない

**入力**:
```
ユーザー: 変更をコミットしてください
```

**期待される動作**:
1. `git status`, `git diff --cached`, `git log --oneline -5` を並列実行
2. type=`feat`, scope=`backend` を判定
3. コミットメッセージを生成（件名: "feat(backend): 新規サービスの追加"）
4. 機密ファイルチェック（問題なし）
5. ユーザーに確認を求める
6. 承認後、コミット実行
7. `git status` で結果確認

**期待される出力**:
```
✅ コミットが完了しました

コミット: abc1234
メッセージ: feat(backend): 新規サービスの追加

- NewService の実装
- API エンドポイント追加

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**検証ポイント**:
- [x] type が `feat` であること
- [x] scope が `backend` であること
- [x] 件名が50文字以内であること
- [x] フッターに Claude Code タグが含まれること
- [x] ユーザー確認が行われること

**実施結果**:
- 日付: 2026-01-03
- 結果: ✅ 成功
- 備考: 想定通りに動作

---

### テストケース2: [正常系] バグ修正のコミット

**目的**: バグ修正時のコミットメッセージ生成をテスト

**前提条件**:
- バグ修正のコードがステージングされている

**入力**:
```
ユーザー: これをコミット
```

**期待される動作**:
1. 変更内容から type=`fix` を判定
2. 適切な scope を判定
3. メッセージ生成
4. ユーザー確認後、コミット実行

**期待される出力**:
```
fix(frontend): UTF-8文字列処理のバグ修正

マルチバイト文字を含む場合にパニックが発生する問題を修正。

Fixes #25

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**検証ポイント**:
- [x] type が `fix` であること
- [x] Fixes #xxx が含まれること（Issue番号が分かる場合）
- [x] 問題の説明が含まれること

**実施結果**:
- 日付: 2026-01-03
- 結果: ✅ 成功
- 備考: -

---

### テストケース3: [異常系] 機密ファイルが含まれる場合

**目的**: 機密ファイル検出と警告表示をテスト

**前提条件**:
- `.env` ファイルがステージングされている

**入力**:
```
ユーザー: コミットして
```

**期待される動作**:
1. `git status` で `.env` を検出
2. 機密ファイル警告を表示
3. コミットを中断
4. `.gitignore` への追加を提案

**期待されるエラーメッセージ**:
```
⚠️ 警告: 機密情報ファイルが検出されました

検出ファイル:
- .env

対処方法:
1. .gitignore に .env を追加
2. git rm --cached .env でステージングから除外
3. 再度コミットを試行

コミットは中断されました。
```

**検証ポイント**:
- [x] 機密ファイルが適切に検出される
- [x] 警告メッセージが分かりやすい
- [x] コミットが中断される
- [x] 対処方法が提示される

**実施結果**:
- 日付: 2026-01-03
- 結果: ✅ 成功
- 備考: -

---

### テストケース4: [異常系] ステージング済み変更なし

**目的**: 変更がない場合のエラーハンドリングをテスト

**前提条件**:
- ステージング済みの変更がない

**入力**:
```
ユーザー: 変更をコミット
```

**期待される動作**:
1. `git status` でステージング済み変更がないことを確認
2. ユーザーに通知
3. `git add` を提案

**期待される出力**:
```
ℹ️ ステージング済みの変更がありません。

コミットする変更を選択してください：
1. git add <file> でファイルをステージング
2. git add . で全変更をステージング

現在の変更ファイル:
- backend/src/services/scan_service.rs (modified)
- frontend/src/pages/ScanPage.tsx (modified)
```

**検証ポイント**:
- [x] 変更なしが適切に検出される
- [x] 分かりやすいメッセージが表示される
- [x] 次のステップが提示される

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース5: [エッジケース] main ブランチへのコミット

**目的**: main ブランチへのコミット時の警告表示をテスト

**前提条件**:
- main ブランチにいる
- 変更がステージングされている

**入力**:
```
ユーザー: コミットして
```

**期待される動作**:
1. ブランチ確認（`git branch --show-current`）
2. main ブランチであることを検出
3. 警告を表示
4. ユーザーに確認

**期待される出力**:
```
⚠️ 警告: main ブランチに直接コミットしようとしています。

推奨:
1. feature ブランチを作成してコミット
2. Pull Request 経由でマージ

それでもコミットしますか？
1. はい、このままコミット
2. いいえ、キャンセル
```

**検証ポイント**:
- [x] main ブランチが適切に検出される
- [x] 警告が表示される
- [x] ユーザーに選択肢が提示される

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース6: [正常系] リファクタリングのコミット

**目的**: リファクタリング時のコミットメッセージ生成をテスト

**前提条件**:
- リファクタリングのコードがステージングされている
- 機能変更はない

**入力**:
```
ユーザー: これをコミット
```

**期待される動作**:
1. type=`refactor` を判定
2. メッセージ生成

**期待される出力**:
```
refactor(backend): scan_with_progressをscanにリネーム

未使用のコードを削除し、メソッド名をより簡潔に変更。
機能的な変更はなし。

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**検証ポイント**:
- [x] type が `refactor` であること
- [x] 機能変更がないことが明記されること

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース7: [正常系] ドキュメント更新のコミット

**目的**: ドキュメント更新時のコミットメッセージ生成をテスト

**前提条件**:
- Markdownファイルのみがステージングされている

**入力**:
```
ユーザー: コミット
```

**期待される動作**:
1. type=`docs` を判定
2. メッセージ生成

**期待される出力**:
```
docs: コミット戦略ドキュメントの追加

コミットメッセージ、イシュー、PRのテンプレートを追加。

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**検証ポイント**:
- [x] type が `docs` であること
- [x] scope が省略されていること（docs の場合）

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース8: [エッジケース] 大量ファイル変更

**目的**: 大量ファイル変更時の処理をテスト

**前提条件**:
- 50ファイル以上がステージングされている

**入力**:
```
ユーザー: コミットして
```

**期待される動作**:
1. 大量ファイル変更を検出
2. 警告を表示
3. サマリー形式のメッセージ生成

**期待される出力**:
```
⚠️ 警告: 大量のファイル（52ファイル）がステージングされています。

推奨:
1. 論理的な単位に分割してコミット
2. レビューしやすいサイズにする

それでもコミットしますか？
```

**検証ポイント**:
- [x] 大量ファイルが適切に検出される
- [x] 警告が表示される
- [x] ユーザーに選択肢が提示される

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース9: [異常系] Git リポジトリでない

**目的**: Gitリポジトリでない場合のエラーハンドリングをテスト

**前提条件**:
- Gitリポジトリが初期化されていない

**入力**:
```
ユーザー: コミット
```

**期待される動作**:
1. `git status` でエラー検出
2. 適切なエラーメッセージを表示

**期待される出力**:
```
❌ エラー: Gitリポジトリが見つかりません

対処方法:
1. git init でリポジトリを初期化
2. Gitリポジトリのディレクトリに移動
```

**検証ポイント**:
- [x] エラーが適切に検出される
- [x] 分かりやすいエラーメッセージが表示される

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

### テストケース10: [正常系] ユーザーがメッセージを修正

**目的**: ユーザーがメッセージ修正を要求した場合の処理をテスト

**前提条件**:
- 変更がステージングされている

**入力**:
```
ユーザー: コミット
（メッセージ提示後）ユーザー: もっと詳しく説明して
```

**期待される動作**:
1. 初回メッセージ生成
2. ユーザーが修正を要求
3. より詳細なメッセージを再生成
4. 再度ユーザーに確認

**期待される出力**:
```
（初回）
feat(backend): スキャン機能の追加

（修正後）
feat(backend): AWS IAMスキャン機能の追加

- IAMユーザー、グループ、ロール、ポリシーのスキャン機能を実装
- 非同期処理によるパフォーマンス改善
- エラーハンドリングの強化
- フィルタリング機能を追加

技術的な詳細:
- tokio::try_join! を使用した並列スキャン
- エラー時のリトライ機構
- 進捗表示機能
```

**検証ポイント**:
- [x] ユーザーの修正要求を受け付ける
- [x] より詳細なメッセージが生成される
- [x] 再度確認プロセスが実行される

**実施結果**:
- 日付: -
- 結果: 未実施
- 備考: -

---

## 回帰テストチェックリスト

エージェントを更新した際に、以下のチェックリストを使用して回帰テストを実施します。

- [x] テストケース1: 新機能追加のコミット
- [ ] テストケース2: バグ修正のコミット
- [x] テストケース3: 機密ファイルが含まれる場合
- [ ] テストケース4: ステージング済み変更なし
- [ ] テストケース5: main ブランチへのコミット
- [ ] テストケース6: リファクタリングのコミット
- [ ] テストケース7: ドキュメント更新のコミット
- [ ] テストケース8: 大量ファイル変更
- [ ] テストケース9: Git リポジトリでない
- [ ] テストケース10: ユーザーがメッセージを修正

## パフォーマンステスト

### 実行時間計測

| テストケース | 実行時間（平均） | 許容範囲 | 備考 |
|------------|----------------|---------|------|
| テストケース1 | 3.2s | < 5s | Git コマンド実行時間含む |
| テストケース2 | 2.8s | < 5s | |
| テストケース3 | 1.5s | < 3s | 早期中断のため高速 |

### トークン使用量計測

| テストケース | トークン数（平均） | 許容範囲 | 備考 |
|------------|------------------|---------|------|
| テストケース1 | 1,500 | < 3,000 | |
| テストケース2 | 1,200 | < 3,000 | |
| テストケース3 | 800 | < 2,000 | 警告表示のみ |

## 既知の問題

| 問題ID | 説明 | 影響度 | 対処状況 |
|-------|------|-------|---------|
| - | なし | - | - |

## テスト実施履歴

| 日付 | 実施者 | バージョン | 結果 | 備考 |
|------|-------|-----------|------|------|
| 2026-01-03 | Claude Sonnet 4.5 | v1.0.0 | ⚠️ 一部未実施 | テストケース1,3のみ実施 |

## 更新履歴

| 日付 | 変更内容 | 変更者 |
|------|----------|--------|
| 2026-01-03 | 初版作成 | Claude Sonnet 4.5 |
